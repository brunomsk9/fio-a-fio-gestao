FROM node:18-alpine as build

WORKDIR /app

# Copia apenas os arquivos de dependências primeiro
COPY fio-a-fio-gestao/package*.json fio-a-fio-gestao/bun.lockb ./fio-a-fio-gestao/

# Copia o restante do código
COPY fio-a-fio-gestao ./fio-a-fio-gestao

# Vai para a subpasta do projeto
WORKDIR /app/fio-a-fio-gestao

# Instala as dependências
RUN npm install

# Builda o projeto
RUN npm run build

# Estágio de produção com Nginx
FROM nginx:alpine

# Copia os arquivos buildados para o Nginx
COPY --from=build /app/fio-a-fio-gestao/dist /usr/share/nginx/html

# Copia a configuração do Nginx
COPY fio-a-fio-gestao/nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
